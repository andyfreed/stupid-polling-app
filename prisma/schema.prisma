generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Source {
  votehub
  civicapi
  fivethirtyeight
}

model Poll {
  id            String      @id @default(uuid())
  source        Source
  sourcePollId  String

  pollType      String
  subject       String?
  jurisdiction  String?
  office        String?

  startDate     DateTime?
  endDate       DateTime?

  sampleSize    Int?
  population    String?

  pollster      String?
  sponsor       String?
  methodology   String?
  url           String?

  internal      Boolean?
  partisan      Boolean?
  hypothetical  Boolean?

  raw           Json

  answers       PollAnswer[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([source, sourcePollId])
  @@index([pollType, endDate])
  @@index([subject])
  @@index([pollster])
}

model PollAnswer {
  id        String  @id @default(uuid())
  pollId    String
  poll      Poll    @relation(fields: [pollId], references: [id], onDelete: Cascade)

  choice    String
  party     String?
  percent   Float?

  @@index([pollId])
}

model PollRun {
  id         String   @id @default(uuid())
  source     Source
  startedAt  DateTime @default(now())
  finishedAt DateTime?
  status     String
  stats      Json?
  error      String?

  @@index([source, startedAt])
}
